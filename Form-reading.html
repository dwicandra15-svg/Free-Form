<<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Reading Assessment App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-500 to-purple-600 min-h-screen p-3">
    <div id="app" class="max-w-4xl mx-auto"></div>
 
    <script>
        // =========================
        // üîê ADMIN CREDENTIALS
        // =========================
        const ADMIN_USERNAME = 'Unknown';
        const ADMIN_PASSWORD = '123456';
        const STORAGE_KEY = 'reading_missions_v1';
 
        // =========================
        // üß© STATE MANAGEMENT
        // =========================
        let state = {
            // student
            studentName: '',
            studentClass: '',
            selectedLevel: '',
            showForm: true,
            currentMission: 0,
            missionScores: Array(7).fill(null), // will be resized after level chosen
            showFinalScore: false,
            isSpeaking: false,
            isRecording: false,
            transcript: '',
            showResult: false,
            recognition: null,
            errorMessage: '',
 
            // admin
            showAdminLogin: false,
            showAdminMenu: false,
            adminView: null, // 'menu' | 'add' | 'change'
            isAdmin: false,
            adminUser: '',
            adminPass: '',
            adminSelectedLevel: 'beginner',
            adminNewSentence: '',
            adminEditIndex: null,
            adminEditValue: '',
 
currentChapter: 'Chapter 2: Taking Trips',
currentUnit: 'Unit 2: What an Experience',
        };
 
        // =========================
        // üìö DEFAULT MISSIONS (BASE)
        // =========================
        const defaultMissions = {
            beginner: [
                "I love to travel and see new places",
                "The beach is very beautiful today",
                "We visited a wonderful museum yesterday",
                "My family enjoys camping in the mountains",
                "The hotel room has a nice view",
                "I like to take pictures of nature",
                "Traveling makes me very happy"
            ],
            intermediate: [
                "I had an amazing experience during my trip to Bali",
                "The view from the mountain top was absolutely breathtaking",
                "We explored ancient temples and learned about local culture",
                "Swimming in the crystal clear water was unforgettable",
                "The traditional dance performance was truly spectacular",
                "Meeting friendly locals made our journey more meaningful",
                "This vacation created wonderful memories that will last forever"
            ],
            advanced: [
                "Embarking on this extraordinary adventure provided invaluable insights into diverse cultures",
                "The magnificent landscape encompassed towering peaks and pristine valleys below",
                "Our expedition through historical landmarks revealed fascinating architectural achievements",
                "Experiencing authentic cuisine while interacting with indigenous communities was remarkable",
                "The mesmerizing performance showcased centuries-old traditions passed through generations",
                "Establishing connections with welcoming inhabitants enriched our understanding significantly",
                "This remarkable journey profoundly transformed our perspectives on global diversity"
            ],
            expert: [
                "Traversing through this unprecedented expedition yielded profound comprehension of multifaceted civilizations",
                "The awe-inspiring topography encompassed monumental summits and immaculate geological formations",
                "Our archaeological investigation unveiled extraordinary testimonials of sophisticated engineering methodologies",
                "Encountering gastronomic authenticity whilst engaging with aboriginal populations proved extraordinarily enlightening",
                "The captivating theatrical presentation exemplified antiquated customs meticulously preserved across millennia",
                "Cultivating meaningful rapport with hospitable denizens substantially augmented our anthropological cognizance",
                "This transformative odyssey fundamentally revolutionized our philosophical paradigms regarding intercultural dynamics"
            ]
        };
 
        // =========================
        // üíæ LOCAL STORAGE HELPERS
        // =========================
        function loadMissions() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return JSON.parse(JSON.stringify(defaultMissions));
                const parsed = JSON.parse(raw);
                // safety: ensure all levels exist
                for (const key of ['beginner','intermediate','advanced','expert']) {
                    if (!Array.isArray(parsed[key])) parsed[key] = [...defaultMissions[key]];
                }
                return parsed;
            } catch {
                return JSON.parse(JSON.stringify(defaultMissions));
            }
        }
        function saveMissions(missions) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(missions));
        }
        let missionsByLevel = loadMissions(); // source of truth
 
        // =========================
        // üèÅ SCORING THRESHOLDS
        // =========================
        const scoringThresholds = {
            beginner: { excellent: 70, good: 50, enough: 30 },
            intermediate: { excellent: 80, good: 60, enough: 35 },
            advanced: { excellent: 88, good: 68, enough: 42 },
            expert: { excellent: 95, good: 75, enough: 50 }
        };
 
        // =========================
        // üé§ SPEECH RECOGNITION
        // =========================
        function initializeSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                state.errorMessage = '‚ùå Browser tidak mendukung Speech Recognition. Gunakan Chrome!';
                return false;
            }
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            recognition.maxAlternatives = 1;
 
            recognition.onstart = () => { state.isRecording = true; state.errorMessage=''; render(); };
            recognition.onresult = (event) => {
                const spokenText = event.results[0][0].transcript;
                state.transcript = spokenText;
                state.isRecording = false;
                state.errorMessage = '';
                render();
            };
            recognition.onerror = (event) => {
                state.isRecording = false;
                if (event.error === 'not-allowed' || event.error === 'permission-denied') {
                    state.errorMessage = '‚ùå Microphone ditolak! Buka Settings > Site settings > Microphone > Allow';
                } else if (event.error === 'no-speech') {
                    state.errorMessage = '‚ö†Ô∏è Tidak ada suara terdeteksi. Coba lagi dan bicara lebih keras!';
                } else if (event.error === 'aborted') {
                    state.errorMessage = '‚ö†Ô∏è Recording dibatalkan. Coba lagi!';
                } else {
                    state.errorMessage = '‚ùå Error: ' + event.error;
                }
                render();
            };
            recognition.onend = () => { state.isRecording = false; render(); };
            state.recognition = recognition;
            return true;
        }
 
        async function testMicrophone() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
                alert('‚úÖ MICROPHONE BERHASIL!\n\nSekarang Anda bisa:\n1. Klik LISTEN untuk mendengar\n2. Klik JUDGE untuk merekam\n3. Klik RESULT untuk nilai');
                state.errorMessage = '‚úÖ Microphone OK! Siap digunakan.';
                render();
            } catch (error) {
                alert('‚ùå MICROPHONE TIDAK DAPAT DIAKSES!\n\nCara mengizinkan:\n\nüì± ANDROID:\n1. Tap 3 titik (‚ãÆ)\n2. Tap "Site settings"\n3. Tap "Microphone"\n4. Pilih "Allow"\n5. Refresh (F5)');
                state.errorMessage = '‚ùå Microphone ditolak!';
                render();
            }
        }
 
        // =========================
        // üßÆ ASSESSMENT LOGIC
        // =========================
        function handleStartAssessment() {
            const name = document.getElementById('studentName').value.trim();
            const className = document.getElementById('studentClass').value.trim();
            const level = document.getElementById('level').value;
 
            if (!name || !className) { alert('‚ö†Ô∏è Mohon isi Nama dan Kelas!'); return; }
            if (!level) { alert('‚ö†Ô∏è Mohon pilih Level Kesulitan!'); return; }
 
            state.studentName = name;
            state.studentClass = className;
            state.selectedLevel = level;
            state.showForm = false;
 
            // Resize missionScores dynamically to the number of missions in the selected level (Mode A)
            const totalMissions = missionsByLevel[state.selectedLevel].length;
            state.missionScores = Array(totalMissions).fill(null);
 
            if (!initializeSpeechRecognition()) {
                alert('‚ùå Browser tidak mendukung Speech Recognition!');
            }
            render();
        }
 
        function speakText() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                state.isSpeaking = false;
                render();
                return;
            }
            window.speechSynthesis.cancel();
            const missions = missionsByLevel[state.selectedLevel];
            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(missions[state.currentMission]);
                utterance.lang = 'en-US';
                utterance.rate = 0.6;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                utterance.onstart = () => { state.isSpeaking = true; render(); };
                utterance.onend = () => { state.isSpeaking = false; render(); };
                utterance.onerror = () => { state.isSpeaking = false; render(); };
                window.speechSynthesis.speak(utterance);
            }, 100);
        }
 
        function handleJudge() {
            if (!state.recognition) { alert('‚ùå Speech Recognition tidak tersedia!'); return; }
            state.transcript = '';
            state.showResult = false;
            state.errorMessage = '';
            try {
                state.recognition.start();
            } catch (error) {
                if (error.message && error.message.includes('already started')) {
                    state.recognition.stop();
                    setTimeout(() => {
                        try { state.recognition.start(); }
                        catch { state.errorMessage = '‚ùå Gagal memulai recording.'; render(); }
                    }, 500);
                } else {
                    state.errorMessage = '‚ùå Gagal memulai recording.';
                    render();
                }
            }
        }
 
        function calculateScore(original, spoken, level) {
            if (!spoken || spoken.trim() === '') return 'Bad';
            const normalize = (text) => text.toLowerCase().replace(/[.,!?'"]/g, '').replace(/\s+/g, ' ').trim();
            const originalWords = normalize(original).split(' ');
            const spokenWords = normalize(spoken).split(' ');
            let matches = 0;
            originalWords.forEach(word => { if (spokenWords.includes(word)) matches++; });
            const accuracy = (matches / originalWords.length) * 100;
            const thresholds = scoringThresholds[level];
            if (accuracy >= thresholds.excellent) return 'Excellent';
            if (accuracy >= thresholds.good) return 'Good';
            if (accuracy >= thresholds.enough) return 'Enough';
            return 'Bad';
        }
 
        function handleResult() {
            if (!state.transcript || state.transcript.trim() === '') {
                alert('‚ö†Ô∏è BELUM ADA REKAMAN!\n\n1. Klik JUDGE\n2. Baca kalimat\n3. Tunggu teks muncul\n4. Klik RESULT');
                return;
            }
            const missions = missionsByLevel[state.selectedLevel];
            const score = calculateScore(missions[state.currentMission], state.transcript, state.selectedLevel);
            state.missionScores[state.currentMission] = score;
            state.showResult = true;
            render();
        }
 
        function handleNext() {
            if (!state.missionScores[state.currentMission]) { alert('‚ö†Ô∏è Klik RESULT dulu untuk mendapat nilai!'); return; }
            const total = missionsByLevel[state.selectedLevel].length;
            if (state.currentMission < total - 1) {
                state.currentMission++;
                state.transcript = '';
                state.showResult = false;
                state.errorMessage = '';
            } else {
                state.showFinalScore = true;
            }
            render();
        }
 
        function calculateFinalScore() {
            const scoreValues = { 'Excellent': 100, 'Good': 75, 'Enough': 50, 'Bad': 25 };
            const total = missionsByLevel[state.selectedLevel].length || 1;
            const sum = state.missionScores.reduce((s, sc) => s + (scoreValues[sc] || 0), 0);
            return Math.round(sum / total);
        }
 
        function getFinalGrade(avgScore) {
            if (avgScore >= 85) return 'Excellent';
            if (avgScore >= 65) return 'Good';
            if (avgScore >= 40) return 'Enough';
            return 'Bad';
        }
 
        function getScoreColor(score) {
            const colors = {
                'Excellent': 'bg-green-500 text-white border-green-600',
                'Good': 'bg-blue-500 text-white border-blue-600',
                'Enough': 'bg-yellow-500 text-white border-yellow-600',
                'Bad': 'bg-red-500 text-white border-red-600'
            };
            return colors[score] || 'bg-gray-500 text-white border-gray-600';
        }
 
        function getScoreColorLight(score) {
            const colors = {
                'Excellent': 'text-green-700 bg-green-100 border-green-400',
                'Good': 'text-blue-700 bg-blue-100 border-blue-400',
                'Enough': 'text-yellow-700 bg-yellow-100 border-yellow-400',
                'Bad': 'text-red-700 bg-red-100 border-red-400'
            };
            return colors[score] || 'text-gray-700 bg-gray-100 border-gray-400';
        }
 
        function getLevelBadgeColor(level) {
            const colors = { beginner: 'bg-green-500', intermediate: 'bg-blue-500', advanced: 'bg-purple-500', expert: 'bg-red-500' };
            return colors[level] || 'bg-gray-500';
        }
 
        function getLevelName(level) {
            const names = { beginner: 'üå± BEGINNER', intermediate: 'üåø INTERMEDIATE', advanced: 'üå≥ ADVANCED', expert: 'üèÜ EXPERT' };
            return names[level] || level;
        }
 
        function restartApp() {
            state = {
                studentName: '',
                studentClass: '',
                selectedLevel: '',
                showForm: true,
                currentMission: 0,
                missionScores: Array(7).fill(null),
                showFinalScore: false,
                isSpeaking: false,
                isRecording: false,
                transcript: '',
                showResult: false,
                recognition: null,
                errorMessage: '',
                // admin
                showAdminLogin: false,
                showAdminMenu: false,
                adminView: null,
                isAdmin: false,
                adminUser: '',
                adminPass: '',
                adminSelectedLevel: 'beginner',
                adminNewSentence: '',
                adminEditIndex: null,
                adminEditValue: '',
            };
            render();
        }
 
        // =========================
        // üîß ADMIN FUNCTIONS
        // =========================
        function openAdmin() {
            state.showAdminLogin = true;
            state.showAdminMenu = false;
            state.adminView = null;
            render();
        }
        function closeAdminAll() {
            state.showAdminLogin = false;
            state.showAdminMenu = false;
            state.adminView = null;
            state.isAdmin = false;
            state.adminUser = '';
            state.adminPass = '';
            state.adminNewSentence = '';
            state.adminEditIndex = null;
            state.adminEditValue = '';
            render();
        }
        function handleAdminLogin() {
            if (state.adminUser === ADMIN_USERNAME && state.adminPass === ADMIN_PASSWORD) {
                state.isAdmin = true;
                state.showAdminLogin = false;
                state.showAdminMenu = true;
                state.adminView = 'menu';
            } else {
                alert('‚ùå Username atau Password salah.');
            }
            render();
        }
        function gotoAdminMenu() { state.showAdminMenu = true; state.adminView = 'menu'; render(); }
        function gotoAdd() { state.showAdminMenu = true; state.adminView = 'add'; render(); }
        function gotoChangeChapterUnit() {
    state.adminView = 'chapterUnit';
    render();
}
        function adminLogout() { closeAdminAll(); }
 
        function adminAddMaterial() {
            const txt = (state.adminNewSentence || '').trim();
            if (!txt) { alert('Kalimat tidak boleh kosong.'); return; }
            missionsByLevel[state.adminSelectedLevel].push(txt);
            saveMissions(missionsByLevel);
            state.adminNewSentence = '';
            alert('‚úÖ Materi berhasil ditambahkan.');
            render();
        }
 
        function adminDeleteMaterial(level, index) {function saveChapterUnit() {
    localStorage.setItem('chapter_unit_settings_v1', JSON.stringify({
        chapter: state.currentChapter,
        unit: state.currentUnit
    }));
    alert('‚úÖ Chapter & Unit berhasil diperbarui!');
    render();
}
            if (!confirm('Hapus materi ini?')) return;
            missionsByLevel[level].splice(index, 1);
            saveMissions(missionsByLevel);
            // if currently active level affected during assessment, adjust safely:
            if (!state.showForm && state.selectedLevel === level) {
                const total = missionsByLevel[level].length;
                state.missionScores = state.missionScores.slice(0, total);
                if (state.currentMission >= total) state.currentMission = Math.max(0, total - 1);
            }
            render();
        }
 
        function startEditMaterial(level, index) {
            state.adminEditIndex = index;
            state.adminEditValue = missionsByLevel[level][index];
            render();
        }
        function cancelEditMaterial() {
            state.adminEditIndex = null;
            state.adminEditValue = '';
            render();
        }
        function saveEditMaterial(level, index) {
            const txt = (state.adminEditValue || '').trim();
            if (!txt) { alert('Kalimat tidak boleh kosong.'); return; }
            missionsByLevel[level][index] = txt;
            saveMissions(missionsByLevel);
            state.adminEditIndex = null;
            state.adminEditValue = '';
            alert('‚úÖ Materi diperbarui.');
            render();
        }
 
        // =========================
        // üñºÔ∏è RENDERING
        // =========================
        function renderForm() {
            // ‚Ä¢‚Ä¢‚Ä¢ menu button top-right (only on form page)
            const adminButton = `
                <div class="flex justify-end mb-2">
                    <button onclick="openAdmin()" class="text-white/90 hover:text-white bg-white/10 hover:bg-white/20 backdrop-blur px-3 py-1 rounded-lg text-xl leading-none">‚ãÆ</button>
                </div>
            `;
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="w-full max-w-md">
                        ${adminButton}
                        <div class="bg-white rounded-2xl shadow-2xl p-8">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-3">üìö</div>
                                <h1 class="text-2xl font-bold text-gray-800 mb-2">English Reading Assessment</h1>
                                <p class="text-sm text-gray-600">${state.currentChapter} - ${state.currentUnit}</p>
                            </div>
 
                            <div class="space-y-4 mb-6">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">üë§ Student Name / Nama Siswa:</label>
                                    <input type="text" id="studentName" placeholder="Enter your name"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-base"/>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">üè´ Class / Kelas:</label>
                                    <input type="text" id="studentClass" placeholder="e.g., 7A, 8B, IX-1"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-base"/>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-3">üéØ Difficulty Level / Tingkat Kesulitan:</label>
                                    <select id="level"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-base font-semibold bg-white">
                                        <option value="">-- Select Level --</option>
                                        <option value="beginner">üå± BEGINNER (Easy - Excellent ‚â•70%)</option>
                                        <option value="intermediate">üåø INTERMEDIATE (Normal - Excellent ‚â•80%)</option>
                                        <option value="advanced">üå≥ ADVANCED (Hard - Excellent ‚â•88%)</option>
                                        <option value="expert">üèÜ EXPERT (Very Hard - Excellent ‚â•95%)</option>
                                    </select>
                                </div>
                                <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3">
                                    <p class="text-xs text-yellow-800 font-semibold">‚ö†Ô∏è <strong>Perhatian:</strong> Semakin tinggi level, semakin susah mendapat nilai Excellent!</p>
                                </div>
                            </div>
 
                            <button onclick="handleStartAssessment()"
                                class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 rounded-lg font-bold text-lg hover:from-blue-600 hover:to-purple-700 shadow-lg transform hover:scale-105 transition">
                                üöÄ Start Assessment
                            </button>
                        </div>
                    </div>
                </div>
 
                ${renderAdminOverlays()}
            `;
        }
 
        function renderFinalScore() {
            const finalScore = calculateFinalScore();
            const finalGrade = getFinalGrade(finalScore);
            const thresholds = scoringThresholds[state.selectedLevel];
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl w-full">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-3">üèÜ</div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-1">Assessment Complete!</h1>
                            <p class="text-gray-600">All missions completed</p>
                        </div>
 
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-5 mb-4 border-2 border-blue-300">
                            <div class="grid grid-cols-2 gap-4 mb-3">
                                <div class="text-center border-r border-blue-300 pr-3">
                                    <p class="text-xs text-gray-500 font-bold mb-2 uppercase">Student Name</p>
                                    <p class="text-lg font-black text-gray-800">${state.studentName}</p>
                                </div>
                                <div class="text-center pl-3">
                                    <p class="text-xs text-gray-500 font-bold mb-2 uppercase">Class</p>
                                    <p class="text-lg font-black text-gray-800">${state.studentClass}</p>
                                </div>
                            </div>
                            <div class="text-center pt-3 border-t border-blue-300">
                                <p class="text-xs text-gray-500 font-bold mb-2 uppercase">Difficulty Level</p>
                                <span class="${getLevelBadgeColor(state.selectedLevel)} text-white px-4 py-2 rounded-lg font-black text-sm">
                                    ${getLevelName(state.selectedLevel)}
                                </span>
                                <p class="text-xs text-gray-600 mt-2">Excellent threshold: ‚â•${thresholds.excellent}%</p>
                            </div>
                        </div>
 
                        <div class="bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl p-6 mb-5">
                            <h2 class="text-xl font-semibold text-center mb-3">Final Score</h2>
                            <div class="text-5xl font-bold text-center text-purple-600 mb-2">${finalScore}</div>
                            <div class="text-2xl font-bold text-center py-3 px-4 rounded-lg border-2 ${getScoreColorLight(finalGrade)}">
                                ${finalGrade}
                            </div>
                        </div>
 
                        <div class="space-y-2 mb-5">
                            <h3 class="font-semibold text-gray-700 mb-2">Score per Mission:</h3>
                            ${state.missionScores.map((score, idx) => `
                                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                                    <span class="text-gray-700 font-medium">Mission ${idx + 1}</span>
                                    <span class="font-bold px-4 py-1 rounded border-2 ${getScoreColorLight(score)}">
                                        ${score}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
 
                        <button onclick="restartApp()"
                            class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-bold hover:from-purple-600 hover:to-pink-600 text-lg shadow-lg">
                            üîÑ Start New Assessment
                        </button>
                    </div>
                </div>
            `;
        }
 
        function renderMainApp() {
            const missions = missionsByLevel[state.selectedLevel];
            const total = missions.length;
            const currentScore = state.missionScores[state.currentMission];
            const thresholds = scoringThresholds[state.selectedLevel];
 
            return `
                <!-- Student Info -->
                <div class="bg-white rounded-xl p-4 mb-3 shadow-lg border-2 border-blue-300">
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div class="border-r border-gray-300 pr-3">
                            <p class="text-xs text-gray-500 font-semibold mb-1 uppercase">Student Name</p>
                            <p class="text-base text-gray-800 font-bold truncate">${state.studentName}</p>
                        </div>
                        <div class="pl-3">
                            <p class="text-xs text-gray-500 font-semibold mb-1 uppercase">Class</p>
                            <p class="text-base text-gray-800 font-bold">${state.studentClass}</p>
                        </div>
                    </div>
                    <div class="text-center pt-3 border-t border-gray-300">
                        <span class="${getLevelBadgeColor(state.selectedLevel)} text-white px-3 py-1 rounded-lg font-bold text-xs">
                            ${getLevelName(state.selectedLevel)}
                        </span>
                        <p class="text-xs text-gray-600 mt-1">
                            Excellent: ‚â•${thresholds.excellent}% | Good: ‚â•${thresholds.good}% | Enough: ‚â•${thresholds.enough}%</p>
                    </div>
                </div>
 
                <!-- Test Microphone Button -->
                <button onclick="testMicrophone()"
                    class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 px-4 rounded-xl font-black text-base hover:from-green-600 hover:to-blue-600 mb-3 shadow-lg flex items-center justify-center gap-2">
                    <span class="text-2xl">üé§</span>
                    TEST MICROPHONE (KLIK INI DULU!)
                </button>
 
                <!-- Error Message -->
                ${state.errorMessage ? `
                    <div class="bg-${state.errorMessage.includes('‚úÖ') ? 'green' : 'red'}-50 border-2 border-${state.errorMessage.includes('‚úÖ') ? 'green' : 'red'}-400 rounded-xl p-3 mb-3">
                        <p class="text-${state.errorMessage.includes('‚úÖ') ? 'green' : 'red'}-800 font-bold text-sm text-center">${state.errorMessage}</p>
                    </div>
                ` : ''}
 
                <div class="bg-white rounded-2xl shadow-2xl p-5">
                    <!-- Header -->
                    <div class="text-center mb-4">
                        <h1 class="text-xl font-bold text-gray-800 mb-1">üìö English Reading Test</h1>
                        <p class="text-xs text-gray-600 font-semibold">${state.currentChapter} - ${state.currentUnit}</p>
                        <p class="text-lg text-gray-800 font-bold mt-2">Mission ${state.currentMission + 1} of ${total}</p>
                        <div class="w-full bg-gray-200 rounded-full h-3 mt-2">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all" style="width: ${((state.currentMission + 1) / total) * 100}%"></div>
                        </div>
                    </div>
 
                    <!-- Mission Text -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-4 border-2 border-blue-300">
                        <div class="flex justify-between items-start mb-3">
                            <h2 class="text-sm font-bold text-gray-800">üìñ Read this:</h2>
                            <button onclick="speakText()" class="flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-sm shadow-lg transition ${state.isSpeaking ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-blue-500 hover:bg-blue-600 text-white'}">
                                üîä ${state.isSpeaking ? 'STOP' : 'LISTEN'}
                            </button>
                        </div>
                        <p class="text-base text-gray-800 leading-relaxed font-semibold">"${missions[state.currentMission]}"</p>
                    </div>
 
                    <!-- Recording Status -->
                    ${state.isRecording ? `
                        <div class="bg-red-50 border-2 border-red-500 rounded-xl p-4 mb-4 text-center animate-pulse">
                            <div class="text-5xl mb-2">üé§</div>
                            <p class="text-red-800 font-black text-lg">RECORDING...</p>
                            <p class="text-red-600 font-bold text-sm">Speak clearly now!</p>
                        </div>
                    ` : ''}
 
                    <!-- Transcript -->
                    ${state.transcript ? `
                        <div class="bg-green-50 border-2 border-green-500 rounded-xl p-4 mb-4">
                            <p class="text-xs text-green-700 font-bold mb-2">‚úÖ YOUR RECORDING:</p>
                            <p class="text-sm text-gray-800 font-semibold italic">"${state.transcript}"</p>
                            <p class="text-xs text-green-600 mt-2 font-bold">üëâ Click RESULT to get score</p>
                        </div>
                    ` : ''}
 
                    <!-- Score Display -->
                    ${state.showResult && currentScore ? `
                        <div class="rounded-xl p-5 mb-4 text-center border-4 shadow-xl ${getScoreColor(currentScore)}">
                            <div class="text-5xl mb-2">‚úì</div>
                            <p class="text-sm font-bold mb-1">YOUR SCORE:</p>
                            <p class="text-4xl font-black mb-2">${currentScore}</p>
                        </div>
                    ` : ''}
 
                    <!-- Action Buttons -->
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <button onclick="handleJudge()" ${state.isRecording ? 'disabled' : ''} class="bg-green-500 text-white py-4 rounded-xl font-black text-sm hover:bg-green-600 disabled:bg-gray-400 shadow-lg">
                            <div class="text-2xl mb-1">üé§</div>
                            JUDGE
                        </button>
                        <button onclick="handleResult()" ${!state.transcript || state.isRecording ? 'disabled' : ''} class="bg-blue-500 text-white py-4 rounded-xl font-black text-sm hover:bg-blue-600 disabled:bg-gray-400 shadow-lg">
                            <div class="text-2xl mb-1">‚úì</div>
                            RESULT
                        </button>
                        <button onclick="handleNext()" ${!currentScore ? 'disabled' : ''} class="bg-purple-500 text-white py-4 rounded-xl font-black text-sm hover:bg-purple-600 disabled:bg-gray-400 shadow-lg">
                            <div class="text-2xl mb-1">‚Üí</div>
                            ${state.currentMission < total - 1 ? 'NEXT' : 'FINISH'}
                        </button>
                    </div>
 
                    <!-- Progress -->
                    <div class="flex justify-center gap-2 flex-wrap">
                        ${missions.map((_, idx) => `
                            <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm ${state.missionScores[idx] ? 'bg-green-500 text-white' : idx === state.currentMission ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-600'}">
                                ${idx + 1}
                            </div>
                        `).join('')}
                    </div>
                </div>
 
                <!-- Instructions -->
                <div class="bg-white rounded-xl p-4 mt-3">
                    <h3 class="font-bold text-gray-800 mb-2">üìã STEPS:</h3>
                    <ol class="list-decimal list-inside text-sm text-gray-700 space-y-1">
                        <li>Click <strong class="text-blue-600">LISTEN</strong> to hear pronunciation</li>
                        <li>Click <strong class="text-green-600">JUDGE</strong> to start recording</li>
                        <li><strong>Read the sentence</strong> clearly and loudly</li>
                        <li>Wait for text to appear (green box)</li>
                        <li>Click <strong class="text-blue-600">RESULT</strong> to see your score</li>
                        <li>Click <strong class="text-purple-600">NEXT</strong> for next mission</li>
                    </ol>
                </div>
            `;
        }
 
        // ====== ADMIN OVERLAYS (MODALS) ======
        function renderAdminOverlays() {
            // Login Modal
            const login = state.showAdminLogin ? `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold">Guru Login</h3>
                            <button onclick="closeAdminAll()" class="text-gray-500 hover:text-gray-700">‚úï</button>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Username</label>
                                <input value="${state.adminUser}" oninput="state.adminUser=this.value" class="w-full mt-1 px-3 py-2 border-2 rounded-lg focus:outline-none focus:border-blue-500"/>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Password</label>
                                <input type="password" value="${state.adminPass}" oninput="state.adminPass=this.value" class="w-full mt-1 px-3 py-2 border-2 rounded-lg focus:outline-none focus:border-blue-500"/>
                            </div>
                            <div class="grid grid-cols-2 gap-2 pt-2">
                                <button onclick="closeAdminAll()" class="px-4 py-2 rounded-lg border-2">Cancel</button>
                                <button onclick="handleAdminLogin()" class="px-4 py-2 rounded-lg bg-blue-600 text-white font-bold">Login</button>
                            </div>
                        </div>
                    </div>
                </div>
            ` : '';
 
            // Menu / Add / Change Modals (after login)
            const adminBody = (() => {
                if (!state.showAdminMenu) return '';
                if (state.adminView === 'menu') {
                    return `
                        <div class="space-y-3">
                           <button onclick="gotoAdd()" class="w-full px-4 py-3 rounded-lg bg-green-600 text-white font-bold">‚ûï Add Material</button>
<button onclick="gotoChange()" class="w-full px-4 py-3 rounded-lg bg-blue-600 text-white font-bold">‚úèÔ∏è Change Material</button>
<button onclick="gotoChangeChapterUnit()" class="w-full px-4 py-3 rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-bold">üîÑ Change Chapter & Unit</button>
<button onclick="adminLogout()" class="w-full px-4 py-3 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold">Logout</button>
                        </div>
                    `;
                }
                if (state.adminView === 'add') {
                    const count = missionsByLevel[state.adminSelectedLevel].length;
                    return `
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold">Add Material</h3>
                                <div class="flex gap-2">
                                    <button onclick="gotoAdminMenu()" class="px-3 py-1 rounded-lg border-2">‚¨Ö Back</button>
                                    <button onclick="adminLogout()" class="px-3 py-1 rounded-lg border-2">Logout</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Level</label>
                                <select onchange="state.adminSelectedLevel=this.value; render()" class="w-full mt-1 px-3 py-2 border-2 rounded-lg">
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                    <option value="expert">Expert</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">Current items: <span class="font-bold">${count}</span></p>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Sentence</label>
                                <textarea oninput="state.adminNewSentence=this.value" placeholder="Type new reading sentence here..." class="w-full mt-1 px-3 py-2 border-2 rounded-lg min-h-[100px]"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="gotoAdminMenu()" class="px-4 py-2 rounded-lg border-2">Cancel</button>
                                <button onclick="adminAddMaterial()" class="px-4 py-2 rounded-lg bg-green-600 text-white font-bold">Save</button>
                            </div>
                        </div>
                    `;
                }
                if (state.adminView === 'change') {if (state.adminView === 'chapterUnit') {
    return `
        <div class="space-y-3">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-bold">Change Chapter & Unit</h3>
                <button onclick="gotoAdminMenu()" class="px-3 py-1 rounded-lg border-2">‚¨Ö Back</button>
            </div>
 
            <div>
                <label class="text-sm font-semibold text-gray-700">Chapter:</label>
                <input value="${state.currentChapter}" oninput="state.currentChapter=this.value" class="w-full px-3 py-2 border-2 rounded-lg" />
            </div>
 
            <div>
                <label class="text-sm font-semibold text-gray-700">Unit:</label>
                <input value="${state.currentUnit}" oninput="state.currentUnit=this.value" class="w-full px-3 py-2 border-2 rounded-lg" />
            </div>
 
            <button onclick="saveChapterUnit(); gotoAdminMenu();" class="w-full px-4 py-3 rounded-lg bg-purple-600 text-white font-bold">
                SAVE
            </button>
        </div>
    `;
}
                    const level = state.adminSelectedLevel;
                    const list = missionsByLevel[level];
                    return `
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold">Change Material</h3>
                                <div class="flex gap-2">
                                    <button onclick="gotoAdminMenu()" class="px-3 py-1 rounded-lg border-2">‚¨Ö Back</button>
                                    <button onclick="adminLogout()" class="px-3 py-1 rounded-lg border-2">Logout</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Level</label>
                                <select onchange="state.adminSelectedLevel=this.value; state.adminEditIndex=null; state.adminEditValue=''; render()" class="w-full mt-1 px-3 py-2 border-2 rounded-lg">
                                    <option value="beginner" ${level==='beginner'?'selected':''}>Beginner</option>
                                    <option value="intermediate" ${level==='intermediate'?'selected':''}>Intermediate</option>
                                    <option value="advanced" ${level==='advanced'?'selected':''}>Advanced</option>
                                    <option value="expert" ${level==='expert'?'selected':''}>Expert</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">Total: <span class="font-bold">${list.length}</span> item(s)</p>
                            </div>
                            <div class="max-h-[50vh] overflow-y-auto space-y-2">
                                ${list.map((item, idx) => `
                                    <div class="border-2 rounded-lg p-3">
                                        <div class="text-xs text-gray-500 mb-1">#${idx+1}</div>
                                        ${
                                            state.adminEditIndex === idx
                                            ? `
                                                <textarea oninput="state.adminEditValue=this.value" class="w-full px-3 py-2 border-2 rounded-lg min-h-[80px]">${state.adminEditValue}</textarea>
                                                <div class="flex gap-2 mt-2">
                                                    <button onclick="saveEditMaterial('${level}', ${idx})" class="px-3 py-1 rounded-lg bg-blue-600 text-white font-bold">Save</button>
                                                    <button onclick="cancelEditMaterial()" class="px-3 py-1 rounded-lg border-2">Cancel</button>
                                                </div>
                                            `
                                            : `
                                                <p class="text-sm font-semibold text-gray-800">${item}</p>
                                                <div class="flex gap-2 mt-2">
                                                    <button onclick="startEditMaterial('${level}', ${idx})" class="px-3 py-1 rounded-lg bg-blue-600 text-white font-bold">Edit</button>
                                                    <button onclick="adminDeleteMaterial('${level}', ${idx})" class="px-3 py-1 rounded-lg bg-red-600 text-white font-bold">Delete</button>
                                                </div>
                                            `
                                        }
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                return '';
            })();
 
            const adminModal = state.showAdminMenu ? `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-lg">
                        ${adminBody}
                    </div>
                </div>
            ` : '';
 
            return login + adminModal;
        }
 
        function render() {
            const app = document.getElementById('app');
            if (state.showForm) {
                app.innerHTML = renderForm();
            } else if (state.showFinalScore) {
                app.innerHTML = renderFinalScore();
            } else {
                app.innerHTML = renderMainApp();
            }
        }
 
// Load saved Chapter & Unit (if available)
const savedCU = localStorage.getItem('chapter_unit_settings_v1');
if (savedCU) {
    const data = JSON.parse(savedCU);
    state.currentChapter = data.chapter;
    state.currentUnit = data.unit;
}
 
// Initial render
render();
</script>
</body>
</html>
Tags: 
RAW Paste Data 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Reading Assessment App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-500 to-purple-600 min-h-screen p-3">
    <div id="app" class="max-w-4xl mx-auto"></div>

    <script>
        // =========================
        // üîê ADMIN CREDENTIALS
        // =========================
        const ADMIN_USERNAME = 'Unknown';
        const ADMIN_PASSWORD = '123456';
        const STORAGE_KEY = 'reading_missions_v1';

        // =========================
        // üß© STATE MANAGEMENT
        // =========================
        let state = {
            // student
            studentName: '',
            studentClass: '',
            selectedLevel: '',
            showForm: true,
            currentMission: 0,
            missionScores: Array(7).fill(null), // will be resized after level chosen
            showFinalScore: false,
            isSpeaking: false,
            isRecording: false,
            transcript: '',
            showResult: false,
            recognition: null,
            errorMessage: '',

            // admin
            showAdminLogin: false,
            showAdminMenu: false,
            adminView: null, // 'menu' | 'add' | 'change'
            isAdmin: false,
            adminUser: '',
            adminPass: '',
            adminSelectedLevel: 'beginner',
            adminNewSentence: '',
            adminEditIndex: null,
            adminEditValue: '',

currentChapter: 'Chapter 2: Taking Trips',
currentUnit: 'Unit 2: What an Experience',
        };

        // =========================
        // üìö DEFAULT MISSIONS (BASE)
        // =========================
        const defaultMissions = {
            beginner: [
                "I love to travel and see new places",
                "The beach is very beautiful today",
                "We visited a wonderful museum yesterday",
                "My family enjoys camping in the mountains",
                "The hotel room has a nice view",
                "I like to take pictures of nature",
                "Traveling makes me very happy"
            ],
            intermediate: [
                "I had an amazing experience during my trip to Bali",
                "The view from the mountain top was absolutely breathtaking",
                "We explored ancient temples and learned about local culture",
                "Swimming in the crystal clear water was unforgettable",
                "The traditional dance performance was truly spectacular",
                "Meeting friendly locals made our journey more meaningful",
                "This vacation created wonderful memories that will last forever"
            ],
            advanced: [
                "Embarking on this extraordinary adventure provided invaluable insights into diverse cultures",
                "The magnificent landscape encompassed towering peaks and pristine valleys below",
                "Our expedition through historical landmarks revealed fascinating architectural achievements",
                "Experiencing authentic cuisine while interacting with indigenous communities was remarkable",
                "The mesmerizing performance showcased centuries-old traditions passed through generations",
                "Establishing connections with welcoming inhabitants enriched our understanding significantly",
                "This remarkable journey profoundly transformed our perspectives on global diversity"
            ],
            expert: [
                "Traversing through this unprecedented expedition yielded profound comprehension of multifaceted civilizations",
                "The awe-inspiring topography encompassed monumental summits and immaculate geological formations",
                "Our archaeological investigation unveiled extraordinary testimonials of sophisticated engineering methodologies",
                "Encountering gastronomic authenticity whilst engaging with aboriginal populations proved extraordinarily enlightening",
                "The captivating theatrical presentation exemplified antiquated customs meticulously preserved across millennia",
                "Cultivating meaningful rapport with hospitable denizens substantially augmented our anthropological cognizance",
                "This transformative odyssey fundamentally revolutionized our philosophical paradigms regarding intercultural dynamics"
            ]
        };

        // =========================
        // üíæ LOCAL STORAGE HELPERS
        // =========================
        function loadMissions() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return JSON.parse(JSON.stringify(defaultMissions));
                const parsed = JSON.parse(raw);
                // safety: ensure all levels exist
                for (const key of ['beginner','intermediate','advanced','expert']) {
                    if (!Array.isArray(parsed[key])) parsed[key] = [...defaultMissions[key]];
                }
                return parsed;
            } catch {
                return JSON.parse(JSON.stringify(defaultMissions));
            }
        }
        function saveMissions(missions) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(missions));
        }
        let missionsByLevel = loadMissions(); // source of truth

        // =========================
        // üèÅ SCORING THRESHOLDS
        // =========================
        const scoringThresholds = {
            beginner: { excellent: 70, good: 50, enough: 30 },
            intermediate: { excellent: 80, good: 60, enough: 35 },
            advanced: { excellent: 88, good: 68, enough: 42 },
            expert: { excellent: 95, good: 75, enough: 50 }
        };

        // =========================
        // üé§ SPEECH RECOGNITION
        // =========================
        function initializeSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                state.errorMessage = '‚ùå Browser tidak mendukung Speech Recognition. Gunakan Chrome!';
                return false;
            }
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            recognition.maxAlternatives = 1;

            recognition.onstart = () => { state.isRecording = true; state.errorMessage=''; render(); };
            recognition.onresult = (event) => {
                const spokenText = event.results[0][0].transcript;
                state.transcript = spokenText;
                state.isRecording = false;
                state.errorMessage = '';
                render();
            };
            recognition.onerror = (event) => {
                state.isRecording = false;
                if (event.error === 'not-allowed' || event.error === 'permission-denied') {
                    state.errorMessage = '‚ùå Microphone ditolak! Buka Settings > Site settings > Microphone > Allow';
                } else if (event.error === 'no-speech') {
                    state.errorMessage = '‚ö†Ô∏è Tidak ada suara terdeteksi. Coba lagi dan bicara lebih keras!';
                } else if (event.error === 'aborted') {
                    state.errorMessage = '‚ö†Ô∏è Recording dibatalkan. Coba lagi!';
                } else {
                    state.errorMessage = '‚ùå Error: ' + event.error;
                }
                render();
            };
            recognition.onend = () => { state.isRecording = false; render(); };
            state.recognition = recognition;
            return true;
        }

        async function testMicrophone() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
                alert('‚úÖ MICROPHONE BERHASIL!\n\nSekarang Anda bisa:\n1. Klik LISTEN untuk mendengar\n2. Klik JUDGE untuk merekam\n3. Klik RESULT untuk nilai');
                state.errorMessage = '‚úÖ Microphone OK! Siap digunakan.';
                render();
            } catch (error) {
                alert('‚ùå MICROPHONE TIDAK DAPAT DIAKSES!\n\nCara mengizinkan:\n\nüì± ANDROID:\n1. Tap 3 titik (‚ãÆ)\n2. Tap "Site settings"\n3. Tap "Microphone"\n4. Pilih "Allow"\n5. Refresh (F5)');
                state.errorMessage = '‚ùå Microphone ditolak!';
                render();
            }
        }

        // =========================
        // üßÆ ASSESSMENT LOGIC
        // =========================
        function handleStartAssessment() {
            const name = document.getElementById('studentName').value.trim();
            const className = document.getElementById('studentClass').value.trim();
            const level = document.getElementById('level').value;

            if (!name || !className) { alert('‚ö†Ô∏è Mohon isi Nama dan Kelas!'); return; }
            if (!level) { alert('‚ö†Ô∏è Mohon pilih Level Kesulitan!'); return; }

            state.studentName = name;
            state.studentClass = className;
            state.selectedLevel = level;
            state.showForm = false;

            // Resize missionScores dynamically to the number of missions in the selected level (Mode A)
            const totalMissions = missionsByLevel[state.selectedLevel].length;
            state.missionScores = Array(totalMissions).fill(null);

            if (!initializeSpeechRecognition()) {
                alert('‚ùå Browser tidak mendukung Speech Recognition!');
            }
            render();
        }

        function speakText() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                state.isSpeaking = false;
                render();
                return;
            }
            window.speechSynthesis.cancel();
            const missions = missionsByLevel[state.selectedLevel];
            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(missions[state.currentMission]);
                utterance.lang = 'en-US';
                utterance.rate = 0.6;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                utterance.onstart = () => { state.isSpeaking = true; render(); };
                utterance.onend = () => { state.isSpeaking = false; render(); };
                utterance.onerror = () => { state.isSpeaking = false; render(); };
                window.speechSynthesis.speak(utterance);
            }, 100);
        }

        function handleJudge() {
            if (!state.recognition) { alert('‚ùå Speech Recognition tidak tersedia!'); return; }
            state.transcript = '';
            state.showResult = false;
            state.errorMessage = '';
            try {
                state.recognition.start();
            } catch (error) {
                if (error.message && error.message.includes('already started')) {
                    state.recognition.stop();
                    setTimeout(() => {
                        try { state.recognition.start(); }
                        catch { state.errorMessage = '‚ùå Gagal memulai recording.'; render(); }
                    }, 500);
                } else {
                    state.errorMessage = '‚ùå Gagal memulai recording.';
                    render();
                }
            }
        }

        function calculateScore(original, spoken, level) {
            if (!spoken || spoken.trim() === '') return 'Bad';
            const normalize = (text) => text.toLowerCase().replace(/[.,!?'"]/g, '').replace(/\s+/g, ' ').trim();
            const originalWords = normalize(original).split(' ');
            const spokenWords = normalize(spoken).split(' ');
            let matches = 0;
            originalWords.forEach(word => { if (spokenWords.includes(word)) matches++; });
            const accuracy = (matches / originalWords.length) * 100;
            const thresholds = scoringThresholds[level];
            if (accuracy >= thresholds.excellent) return 'Excellent';
            if (accuracy >= thresholds.good) return 'Good';
            if (accuracy >= thresholds.enough) return 'Enough';
            return 'Bad';
        }

        function handleResult() {
            if (!state.transcript || state.transcript.trim() === '') {
                alert('‚ö†Ô∏è BELUM ADA REKAMAN!\n\n1. Klik JUDGE\n2. Baca kalimat\n3. Tunggu teks muncul\n4. Klik RESULT');
                return;
            }
            const missions = missionsByLevel[state.selectedLevel];
            const score = calculateScore(missions[state.currentMission], state.transcript, state.selectedLevel);
            state.missionScores[state.currentMission] = score;
            state.showResult = true;
            render();
        }

        function handleNext() {
            if (!state.missionScores[state.currentMission]) { alert('‚ö†Ô∏è Klik RESULT dulu untuk mendapat nilai!'); return; }
            const total = missionsByLevel[state.selectedLevel].length;
            if (state.currentMission < total - 1) {
                state.currentMission++;
                state.transcript = '';
                state.showResult = false;
                state.errorMessage = '';
            } else {
                state.showFinalScore = true;
            }
            render();
        }

        function calculateFinalScore() {
            const scoreValues = { 'Excellent': 100, 'Good': 75, 'Enough': 50, 'Bad': 25 };
            const total = missionsByLevel[state.selectedLevel].length || 1;
            const sum = state.missionScores.reduce((s, sc) => s + (scoreValues[sc] || 0), 0);
            return Math.round(sum / total);
        }

        function getFinalGrade(avgScore) {
            if (avgScore >= 85) return 'Excellent';
            if (avgScore >= 65) return 'Good';
            if (avgScore >= 40) return 'Enough';
            return 'Bad';
        }

        function getScoreColor(score) {
            const colors = {
                'Excellent': 'bg-green-500 text-white border-green-600',
                'Good': 'bg-blue-500 text-white border-blue-600',
                'Enough': 'bg-yellow-500 text-white border-yellow-600',
                'Bad': 'bg-red-500 text-white border-red-600'
            };
            return colors[score] || 'bg-gray-500 text-white border-gray-600';
        }

        function getScoreColorLight(score) {
            const colors = {
                'Excellent': 'text-green-700 bg-green-100 border-green-400',
                'Good': 'text-blue-700 bg-blue-100 border-blue-400',
                'Enough': 'text-yellow-700 bg-yellow-100 border-yellow-400',
                'Bad': 'text-red-700 bg-red-100 border-red-400'
            };
            return colors[score] || 'text-gray-700 bg-gray-100 border-gray-400';
        }

        function getLevelBadgeColor(level) {
            const colors = { beginner: 'bg-green-500', intermediate: 'bg-blue-500', advanced: 'bg-purple-500', expert: 'bg-red-500' };
            return colors[level] || 'bg-gray-500';
        }

        function getLevelName(level) {
            const names = { beginner: 'üå± BEGINNER', intermediate: 'üåø INTERMEDIATE', advanced: 'üå≥ ADVANCED', expert: 'üèÜ EXPERT' };
            return names[level] || level;
        }

        function restartApp() {
            state = {
                studentName: '',
                studentClass: '',
                selectedLevel: '',
                showForm: true,
                currentMission: 0,
                missionScores: Array(7).fill(null),
                showFinalScore: false,
                isSpeaking: false,
                isRecording: false,
                transcript: '',
                showResult: false,
                recognition: null,
                errorMessage: '',
                // admin
                showAdminLogin: false,
                showAdminMenu: false,
                adminView: null,
                isAdmin: false,
                adminUser: '',
                adminPass: '',
                adminSelectedLevel: 'beginner',
                adminNewSentence: '',
                adminEditIndex: null,
                adminEditValue: '',
            };
            render();
        }

        // =========================
        // üîß ADMIN FUNCTIONS
        // =========================
        function openAdmin() {
            state.showAdminLogin = true;
            state.showAdminMenu = false;
            state.adminView = null;
            render();
        }
        function closeAdminAll() {
            state.showAdminLogin = false;
            state.showAdminMenu = false;
            state.adminView = null;
            state.isAdmin = false;
            state.adminUser = '';
            state.adminPass = '';
            state.adminNewSentence = '';
            state.adminEditIndex = null;
            state.adminEditValue = '';
            render();
        }
        function handleAdminLogin() {
            if (state.adminUser === ADMIN_USERNAME && state.adminPass === ADMIN_PASSWORD) {
                state.isAdmin = true;
                state.showAdminLogin = false;
                state.showAdminMenu = true;
                state.adminView = 'menu';
            } else {
                alert('‚ùå Username atau Password salah.');
            }
            render();
        }
        function gotoAdminMenu() { state.showAdminMenu = true; state.adminView = 'menu'; render(); }
        function gotoAdd() { state.showAdminMenu = true; state.adminView = 'add'; render(); }
        function gotoChangeChapterUnit() {
    state.adminView = 'chapterUnit';
    render();
}
        function adminLogout() { closeAdminAll(); }

        function adminAddMaterial() {
            const txt = (state.adminNewSentence || '').trim();
            if (!txt) { alert('Kalimat tidak boleh kosong.'); return; }
            missionsByLevel[state.adminSelectedLevel].push(txt);
            saveMissions(missionsByLevel);
            state.adminNewSentence = '';
            alert('‚úÖ Materi berhasil ditambahkan.');
            render();
        }

        function adminDeleteMaterial(level, index) {function saveChapterUnit() {
    localStorage.setItem('chapter_unit_settings_v1', JSON.stringify({
        chapter: state.currentChapter,
        unit: state.currentUnit
    }));
    alert('‚úÖ Chapter & Unit berhasil diperbarui!');
    render();
}
            if (!confirm('Hapus materi ini?')) return;
            missionsByLevel[level].splice(index, 1);
            saveMissions(missionsByLevel);
            // if currently active level affected during assessment, adjust safely:
            if (!state.showForm && state.selectedLevel === level) {
                const total = missionsByLevel[level].length;
                state.missionScores = state.missionScores.slice(0, total);
                if (state.currentMission >= total) state.currentMission = Math.max(0, total - 1);
            }
            render();
        }

        function startEditMaterial(level, index) {
            state.adminEditIndex = index;
            state.adminEditValue = missionsByLevel[level][index];
            render();
        }
        function cancelEditMaterial() {
            state.adminEditIndex = null;
            state.adminEditValue = '';
            render();
        }
        function saveEditMaterial(level, index) {
            const txt = (state.adminEditValue || '').trim();
            if (!txt) { alert('Kalimat tidak boleh kosong.'); return; }
            missionsByLevel[level][index] = txt;
            saveMissions(missionsByLevel);
            state.adminEditIndex = null;
            state.adminEditValue = '';
            alert('‚úÖ Materi diperbarui.');
            render();
        }

        // =========================
        // üñºÔ∏è RENDERING
        // =========================
        function renderForm() {
            // ‚Ä¢‚Ä¢‚Ä¢ menu button top-right (only on form page)
            const adminButton = `
                <div class="flex justify-end mb-2">
                    <button onclick="openAdmin()" class="text-white/90 hover:text-white bg-white/10 hover:bg-white/20 backdrop-blur px-3 py-1 rounded-lg text-xl leading-none">‚ãÆ</button>
                </div>
            `;
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="w-full max-w-md">
                        ${adminButton}
                        <div class="bg-white rounded-2xl shadow-2xl p-8">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-3">üìö</div>
                                <h1 class="text-2xl font-bold text-gray-800 mb-2">English Reading Assessment</h1>
                                <p class="text-sm text-gray-600">${state.currentChapter} - ${state.currentUnit}</p>
                            </div>

                            <div class="space-y-4 mb-6">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">üë§ Student Name / Nama Siswa:</label>
                                    <input type="text" id="studentName" placeholder="Enter your name"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-base"/>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">üè´ Class / Kelas:</label>
                                    <input type="text" id="studentClass" placeholder="e.g., 7A, 8B, IX-1"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-base"/>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-3">üéØ Difficulty Level / Tingkat Kesulitan:</label>
                                    <select id="level"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-base font-semibold bg-white">
                                        <option value="">-- Select Level --</option>
                                        <option value="beginner">üå± BEGINNER (Easy - Excellent ‚â•70%)</option>
                                        <option value="intermediate">üåø INTERMEDIATE (Normal - Excellent ‚â•80%)</option>
                                        <option value="advanced">üå≥ ADVANCED (Hard - Excellent ‚â•88%)</option>
                                        <option value="expert">üèÜ EXPERT (Very Hard - Excellent ‚â•95%)</option>
                                    </select>
                                </div>
                                <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3">
                                    <p class="text-xs text-yellow-800 font-semibold">‚ö†Ô∏è <strong>Perhatian:</strong> Semakin tinggi level, semakin susah mendapat nilai Excellent!</p>
                                </div>
                            </div>

                            <button onclick="handleStartAssessment()"
                                class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 rounded-lg font-bold text-lg hover:from-blue-600 hover:to-purple-700 shadow-lg transform hover:scale-105 transition">
                                üöÄ Start Assessment
                            </button>
                        </div>
                    </div>
                </div>

                ${renderAdminOverlays()}
            `;
        }

        function renderFinalScore() {
            const finalScore = calculateFinalScore();
            const finalGrade = getFinalGrade(finalScore);
            const thresholds = scoringThresholds[state.selectedLevel];
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl w-full">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-3">üèÜ</div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-1">Assessment Complete!</h1>
                            <p class="text-gray-600">All missions completed</p>
                        </div>

                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-5 mb-4 border-2 border-blue-300">
                            <div class="grid grid-cols-2 gap-4 mb-3">
                                <div class="text-center border-r border-blue-300 pr-3">
                                    <p class="text-xs text-gray-500 font-bold mb-2 uppercase">Student Name</p>
                                    <p class="text-lg font-black text-gray-800">${state.studentName}</p>
                                </div>
                                <div class="text-center pl-3">
                                    <p class="text-xs text-gray-500 font-bold mb-2 uppercase">Class</p>
                                    <p class="text-lg font-black text-gray-800">${state.studentClass}</p>
                                </div>
                            </div>
                            <div class="text-center pt-3 border-t border-blue-300">
                                <p class="text-xs text-gray-500 font-bold mb-2 uppercase">Difficulty Level</p>
                                <span class="${getLevelBadgeColor(state.selectedLevel)} text-white px-4 py-2 rounded-lg font-black text-sm">
                                    ${getLevelName(state.selectedLevel)}
                                </span>
                                <p class="text-xs text-gray-600 mt-2">Excellent threshold: ‚â•${thresholds.excellent}%</p>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl p-6 mb-5">
                            <h2 class="text-xl font-semibold text-center mb-3">Final Score</h2>
                            <div class="text-5xl font-bold text-center text-purple-600 mb-2">${finalScore}</div>
                            <div class="text-2xl font-bold text-center py-3 px-4 rounded-lg border-2 ${getScoreColorLight(finalGrade)}">
                                ${finalGrade}
                            </div>
                        </div>

                        <div class="space-y-2 mb-5">
                            <h3 class="font-semibold text-gray-700 mb-2">Score per Mission:</h3>
                            ${state.missionScores.map((score, idx) => `
                                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                                    <span class="text-gray-700 font-medium">Mission ${idx + 1}</span>
                                    <span class="font-bold px-4 py-1 rounded border-2 ${getScoreColorLight(score)}">
                                        ${score}
                                    </span>
                                </div>
                            `).join('')}
                        </div>

                        <button onclick="restartApp()"
                            class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-bold hover:from-purple-600 hover:to-pink-600 text-lg shadow-lg">
                            üîÑ Start New Assessment
                        </button>
                    </div>
                </div>
            `;
        }

        function renderMainApp() {
            const missions = missionsByLevel[state.selectedLevel];
            const total = missions.length;
            const currentScore = state.missionScores[state.currentMission];
            const thresholds = scoringThresholds[state.selectedLevel];

            return `
                <!-- Student Info -->
                <div class="bg-white rounded-xl p-4 mb-3 shadow-lg border-2 border-blue-300">
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div class="border-r border-gray-300 pr-3">
                            <p class="text-xs text-gray-500 font-semibold mb-1 uppercase">Student Name</p>
                            <p class="text-base text-gray-800 font-bold truncate">${state.studentName}</p>
                        </div>
                        <div class="pl-3">
                            <p class="text-xs text-gray-500 font-semibold mb-1 uppercase">Class</p>
                            <p class="text-base text-gray-800 font-bold">${state.studentClass}</p>
                        </div>
                    </div>
                    <div class="text-center pt-3 border-t border-gray-300">
                        <span class="${getLevelBadgeColor(state.selectedLevel)} text-white px-3 py-1 rounded-lg font-bold text-xs">
                            ${getLevelName(state.selectedLevel)}
                        </span>
                        <p class="text-xs text-gray-600 mt-1">
                            Excellent: ‚â•${thresholds.excellent}% | Good: ‚â•${thresholds.good}% | Enough: ‚â•${thresholds.enough}%</p>
                    </div>
                </div>

                <!-- Test Microphone Button -->
                <button onclick="testMicrophone()"
                    class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 px-4 rounded-xl font-black text-base hover:from-green-600 hover:to-blue-600 mb-3 shadow-lg flex items-center justify-center gap-2">
                    <span class="text-2xl">üé§</span>
                    TEST MICROPHONE (KLIK INI DULU!)
                </button>

                <!-- Error Message -->
                ${state.errorMessage ? `
                    <div class="bg-${state.errorMessage.includes('‚úÖ') ? 'green' : 'red'}-50 border-2 border-${state.errorMessage.includes('‚úÖ') ? 'green' : 'red'}-400 rounded-xl p-3 mb-3">
                        <p class="text-${state.errorMessage.includes('‚úÖ') ? 'green' : 'red'}-800 font-bold text-sm text-center">${state.errorMessage}</p>
                    </div>
                ` : ''}

                <div class="bg-white rounded-2xl shadow-2xl p-5">
                    <!-- Header -->
                    <div class="text-center mb-4">
                        <h1 class="text-xl font-bold text-gray-800 mb-1">üìö English Reading Test</h1>
                        <p class="text-xs text-gray-600 font-semibold">${state.currentChapter} - ${state.currentUnit}</p>
                        <p class="text-lg text-gray-800 font-bold mt-2">Mission ${state.currentMission + 1} of ${total}</p>
                        <div class="w-full bg-gray-200 rounded-full h-3 mt-2">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all" style="width: ${((state.currentMission + 1) / total) * 100}%"></div>
                        </div>
                    </div>

                    <!-- Mission Text -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-4 border-2 border-blue-300">
                        <div class="flex justify-between items-start mb-3">
                            <h2 class="text-sm font-bold text-gray-800">üìñ Read this:</h2>
                            <button onclick="speakText()" class="flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-sm shadow-lg transition ${state.isSpeaking ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-blue-500 hover:bg-blue-600 text-white'}">
                                üîä ${state.isSpeaking ? 'STOP' : 'LISTEN'}
                            </button>
                        </div>
                        <p class="text-base text-gray-800 leading-relaxed font-semibold">"${missions[state.currentMission]}"</p>
                    </div>

                    <!-- Recording Status -->
                    ${state.isRecording ? `
                        <div class="bg-red-50 border-2 border-red-500 rounded-xl p-4 mb-4 text-center animate-pulse">
                            <div class="text-5xl mb-2">üé§</div>
                            <p class="text-red-800 font-black text-lg">RECORDING...</p>
                            <p class="text-red-600 font-bold text-sm">Speak clearly now!</p>
                        </div>
                    ` : ''}

                    <!-- Transcript -->
                    ${state.transcript ? `
                        <div class="bg-green-50 border-2 border-green-500 rounded-xl p-4 mb-4">
                            <p class="text-xs text-green-700 font-bold mb-2">‚úÖ YOUR RECORDING:</p>
                            <p class="text-sm text-gray-800 font-semibold italic">"${state.transcript}"</p>
                            <p class="text-xs text-green-600 mt-2 font-bold">üëâ Click RESULT to get score</p>
                        </div>
                    ` : ''}

                    <!-- Score Display -->
                    ${state.showResult && currentScore ? `
                        <div class="rounded-xl p-5 mb-4 text-center border-4 shadow-xl ${getScoreColor(currentScore)}">
                            <div class="text-5xl mb-2">‚úì</div>
                            <p class="text-sm font-bold mb-1">YOUR SCORE:</p>
                            <p class="text-4xl font-black mb-2">${currentScore}</p>
                        </div>
                    ` : ''}

                    <!-- Action Buttons -->
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <button onclick="handleJudge()" ${state.isRecording ? 'disabled' : ''} class="bg-green-500 text-white py-4 rounded-xl font-black text-sm hover:bg-green-600 disabled:bg-gray-400 shadow-lg">
                            <div class="text-2xl mb-1">üé§</div>
                            JUDGE
                        </button>
                        <button onclick="handleResult()" ${!state.transcript || state.isRecording ? 'disabled' : ''} class="bg-blue-500 text-white py-4 rounded-xl font-black text-sm hover:bg-blue-600 disabled:bg-gray-400 shadow-lg">
                            <div class="text-2xl mb-1">‚úì</div>
                            RESULT
                        </button>
                        <button onclick="handleNext()" ${!currentScore ? 'disabled' : ''} class="bg-purple-500 text-white py-4 rounded-xl font-black text-sm hover:bg-purple-600 disabled:bg-gray-400 shadow-lg">
                            <div class="text-2xl mb-1">‚Üí</div>
                            ${state.currentMission < total - 1 ? 'NEXT' : 'FINISH'}
                        </button>
                    </div>

                    <!-- Progress -->
                    <div class="flex justify-center gap-2 flex-wrap">
                        ${missions.map((_, idx) => `
                            <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm ${state.missionScores[idx] ? 'bg-green-500 text-white' : idx === state.currentMission ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-600'}">
                                ${idx + 1}
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Instructions -->
                <div class="bg-white rounded-xl p-4 mt-3">
                    <h3 class="font-bold text-gray-800 mb-2">üìã STEPS:</h3>
                    <ol class="list-decimal list-inside text-sm text-gray-700 space-y-1">
                        <li>Click <strong class="text-blue-600">LISTEN</strong> to hear pronunciation</li>
                        <li>Click <strong class="text-green-600">JUDGE</strong> to start recording</li>
                        <li><strong>Read the sentence</strong> clearly and loudly</li>
                        <li>Wait for text to appear (green box)</li>
                        <li>Click <strong class="text-blue-600">RESULT</strong> to see your score</li>
                        <li>Click <strong class="text-purple-600">NEXT</strong> for next mission</li>
                    </ol>
                </div>
            `;
        }

        // ====== ADMIN OVERLAYS (MODALS) ======
        function renderAdminOverlays() {
            // Login Modal
            const login = state.showAdminLogin ? `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold">Guru Login</h3>
                            <button onclick="closeAdminAll()" class="text-gray-500 hover:text-gray-700">‚úï</button>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Username</label>
                                <input value="${state.adminUser}" oninput="state.adminUser=this.value" class="w-full mt-1 px-3 py-2 border-2 rounded-lg focus:outline-none focus:border-blue-500"/>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Password</label>
                                <input type="password" value="${state.adminPass}" oninput="state.adminPass=this.value" class="w-full mt-1 px-3 py-2 border-2 rounded-lg focus:outline-none focus:border-blue-500"/>
                            </div>
                            <div class="grid grid-cols-2 gap-2 pt-2">
                                <button onclick="closeAdminAll()" class="px-4 py-2 rounded-lg border-2">Cancel</button>
                                <button onclick="handleAdminLogin()" class="px-4 py-2 rounded-lg bg-blue-600 text-white font-bold">Login</button>
                            </div>
                        </div>
                    </div>
                </div>
            ` : '';

            // Menu / Add / Change Modals (after login)
            const adminBody = (() => {
                if (!state.showAdminMenu) return '';
                if (state.adminView === 'menu') {
                    return `
                        <div class="space-y-3">
                           <button onclick="gotoAdd()" class="w-full px-4 py-3 rounded-lg bg-green-600 text-white font-bold">‚ûï Add Material</button>
<button onclick="gotoChange()" class="w-full px-4 py-3 rounded-lg bg-blue-600 text-white font-bold">‚úèÔ∏è Change Material</button>
<button onclick="gotoChangeChapterUnit()" class="w-full px-4 py-3 rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-bold">üîÑ Change Chapter & Unit</button>
<button onclick="adminLogout()" class="w-full px-4 py-3 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold">Logout</button>
                        </div>
                    `;
                }
                if (state.adminView === 'add') {
                    const count = missionsByLevel[state.adminSelectedLevel].length;
                    return `
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold">Add Material</h3>
                                <div class="flex gap-2">
                                    <button onclick="gotoAdminMenu()" class="px-3 py-1 rounded-lg border-2">‚¨Ö Back</button>
                                    <button onclick="adminLogout()" class="px-3 py-1 rounded-lg border-2">Logout</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Level</label>
                                <select onchange="state.adminSelectedLevel=this.value; render()" class="w-full mt-1 px-3 py-2 border-2 rounded-lg">
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                    <option value="expert">Expert</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">Current items: <span class="font-bold">${count}</span></p>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Sentence</label>
                                <textarea oninput="state.adminNewSentence=this.value" placeholder="Type new reading sentence here..." class="w-full mt-1 px-3 py-2 border-2 rounded-lg min-h-[100px]"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="gotoAdminMenu()" class="px-4 py-2 rounded-lg border-2">Cancel</button>
                                <button onclick="adminAddMaterial()" class="px-4 py-2 rounded-lg bg-green-600 text-white font-bold">Save</button>
                            </div>
                        </div>
                    `;
                }
                if (state.adminView === 'change') {if (state.adminView === 'chapterUnit') {
    return `
        <div class="space-y-3">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-bold">Change Chapter & Unit</h3>
                <button onclick="gotoAdminMenu()" class="px-3 py-1 rounded-lg border-2">‚¨Ö Back</button>
            </div>

            <div>
                <label class="text-sm font-semibold text-gray-700">Chapter:</label>
                <input value="${state.currentChapter}" oninput="state.currentChapter=this.value" class="w-full px-3 py-2 border-2 rounded-lg" />
            </div>

            <div>
                <label class="text-sm font-semibold text-gray-700">Unit:</label>
                <input value="${state.currentUnit}" oninput="state.currentUnit=this.value" class="w-full px-3 py-2 border-2 rounded-lg" />
            </div>

            <button onclick="saveChapterUnit(); gotoAdminMenu();" class="w-full px-4 py-3 rounded-lg bg-purple-600 text-white font-bold">
                SAVE
            </button>
        </div>
    `;
}
                    const level = state.adminSelectedLevel;
                    const list = missionsByLevel[level];
                    return `
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold">Change Material</h3>
                                <div class="flex gap-2">
                                    <button onclick="gotoAdminMenu()" class="px-3 py-1 rounded-lg border-2">‚¨Ö Back</button>
                                    <button onclick="adminLogout()" class="px-3 py-1 rounded-lg border-2">Logout</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Level</label>
                                <select onchange="state.adminSelectedLevel=this.value; state.adminEditIndex=null; state.adminEditValue=''; render()" class="w-full mt-1 px-3 py-2 border-2 rounded-lg">
                                    <option value="beginner" ${level==='beginner'?'selected':''}>Beginner</option>
                                    <option value="intermediate" ${level==='intermediate'?'selected':''}>Intermediate</option>
                                    <option value="advanced" ${level==='advanced'?'selected':''}>Advanced</option>
                                    <option value="expert" ${level==='expert'?'selected':''}>Expert</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">Total: <span class="font-bold">${list.length}</span> item(s)</p>
                            </div>
                            <div class="max-h-[50vh] overflow-y-auto space-y-2">
                                ${list.map((item, idx) => `
                                    <div class="border-2 rounded-lg p-3">
                                        <div class="text-xs text-gray-500 mb-1">#${idx+1}</div>
                                        ${
                                            state.adminEditIndex === idx
                                            ? `
                                                <textarea oninput="state.adminEditValue=this.value" class="w-full px-3 py-2 border-2 rounded-lg min-h-[80px]">${state.adminEditValue}</textarea>
                                                <div class="flex gap-2 mt-2">
                                                    <button onclick="saveEditMaterial('${level}', ${idx})" class="px-3 py-1 rounded-lg bg-blue-600 text-white font-bold">Save</button>
                                                    <button onclick="cancelEditMaterial()" class="px-3 py-1 rounded-lg border-2">Cancel</button>
                                                </div>
                                            `
                                            : `
                                                <p class="text-sm font-semibold text-gray-800">${item}</p>
                                                <div class="flex gap-2 mt-2">
                                                    <button onclick="startEditMaterial('${level}', ${idx})" class="px-3 py-1 rounded-lg bg-blue-600 text-white font-bold">Edit</button>
                                                    <button onclick="adminDeleteMaterial('${level}', ${idx})" class="px-3 py-1 rounded-lg bg-red-600 text-white font-bold">Delete</button>
                                                </div>
                                            `
                                        }
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                return '';
            })();

            const adminModal = state.showAdminMenu ? `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-lg">
                        ${adminBody}
                    </div>
                </div>
            ` : '';

            return login + adminModal;
        }

        function render() {
            const app = document.getElementById('app');
            if (state.showForm) {
                app.innerHTML = renderForm();
            } else if (state.showFinalScore) {
                app.innerHTML = renderFinalScore();
            } else {
                app.innerHTML = renderMainApp();
            }
        }

// Load saved Chapter & Unit (if available)
const savedCU = localStorage.getItem('chapter_unit_settings_v1');
if (savedCU) {
    const data = JSON.parse(savedCU);
    state.currentChapter = data.chapter;
    state.currentUnit = data.unit;
}

// Initial render
render();
</script>
</body>
</html>
Your Comment
Syntax Highlighting:
None
create new paste  /  syntax languages  /  archive  /  faq  /  tools  /  night mode  /  api  /  scraping api  /  news  /  pro
privacy statement  /  cookies policy  /  terms of service /  security disclosure  /  dmca  /  report abuse  /  contact
